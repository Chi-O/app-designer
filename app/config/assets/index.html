<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>
        <link href="css/index.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript" src="commonDefinitions.js"></script>
        <script type="text/javascript" src="libs/jquery-3.2.1.js"></script>
        <script type="text/javascript" src="libs/jquery-migrate-3.0.0.js"></script>
        <script type="text/javascript" src="../../system/js/odkCommon.js"></script>
        <script type="text/javascript" src="../../system/js/odkData.js"></script>
        <script type="text/javascript" src="../../system/tables/js/odkTables.js"></script>

        <script type="text/javascript">

        var titleToken = "main_title";
        var registrationToken = "registration_path";
        var deliveryToken = "delivery_path";
        var dataToken = "data_path";
        var overrideToken = "override_path";
        var registrationTitleToken = 'registration_title';
        var deliveryTitleToken = 'delivery_title';
        var locale = odkCommon.getPreferredLocale();

        // Displays homescreen
        function display() {
            $('#title').text(odkCommon.localizeText(locale, titleToken));

            var newClient = document.createElement("button");
            newClient.innerHTML = odkCommon.localizeText(locale, registrationToken);
            newClient.setAttribute("id", "register");
            newClient.onclick = function() {
                odkTables.launchHTML(null, 
                    'config/assets/choose_method.html?title='
                    + encodeURIComponent(odkCommon.localizeText(locale, registrationTitleToken))
                    + '&type=registration');
            }
            document.getElementById("wrapper").appendChild(newClient);    

            var followUp = document.createElement("button");
            followUp.innerHTML = odkCommon.localizeText(locale, deliveryToken);
            followUp.setAttribute("id", "deliver");
            followUp.onclick = function() {
                odkTables.launchHTML(null,
                    'config/assets/choose_method.html?title='
                    + encodeURIComponent(odkCommon.localizeText(locale, deliveryTitleToken))
                    +'&type=delivery');
            }
            document.getElementById("wrapper").appendChild(followUp);

            var viewData = document.createElement("button");
            viewData.innerHTML = odkCommon.localizeText(locale, dataToken);
            viewData.setAttribute("id", "data");
            viewData.onclick = function() {
              odkTables.launchHTML(null,
                  'config/assets/data_start.html');
            }
            document.getElementById("wrapper").appendChild(viewData);

            // Create a overrides if user is a tables superuser            
            odkData.getRoles(rolesCBSuccess, rolesCBFailure);
        }

        function rolesCBSuccess(result) {
            var roles = result.getRoles();
            console.log(roles);
            if ($.inArray('ROLE_SUPER_USER_TABLES', roles) > -1) {
                var override = document.createElement("button");
                override.innerHTML = odkCommon.localizeText(locale, overrideToken);
                override.setAttribute("id", "overrides");
                override.onclick = function() {
                    odkTables.launchHTML(null,
                        'config/assets/overrides_start.html');
                }
                document.getElementById("wrapper").appendChild(override);
            }
        }

        function rolesCBFailure(error) {
            console.log('roles failed with error: ' + error);
        }
        
        </script>
    </head>

    <body>
        <div id="main">
            <h1 id="title"></h1>
            <div id="wrapper"></div>
        </div>
        <div id="logo"><img src="img/small_2025.jpg"></div>
        <script>
          $(display);
        </script>
    </body>
</html>
